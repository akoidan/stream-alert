{"version":3,"file":"bundle.js","sources":["../src/app/custom-logger.ts","../src/telegram/telegram-model.ts","../src/telegram/telegram-service.ts","../src/telegram/telegram-module.ts","../src/native/native-model.ts","../src/imagelib/imagelib-model.ts","../src/imagelib/imagelib-service.ts","../src/native/native-module.ts","../src/imagelib/imagelib-module.ts","../src/stream/stream-model.ts","../src/stream/stream-service.ts","../src/stream/stream-module.ts","../src/app/app-service.ts","../src/app/app-module.ts","../src/main-vite.ts"],"sourcesContent":["/* eslint-disable no-console */\r\nimport {ConsoleLogger, Injectable,} from '@nestjs/common';\r\nimport clc from 'cli-color';\r\n\r\n\r\n@Injectable()\r\nclass CustomLogger extends ConsoleLogger {\r\n\r\n  private logFormat(\r\n    level: string,\r\n    message: string,\r\n    levelColor: (text: string) => string,\r\n    messageStyle?: (text: string) => string\r\n  ): string {\r\n    const timestamp = clc.xterm(100)(`[${this.getCurrentTime()}]`);\r\n\r\n\r\n    const id =  levelColor(level);\r\n    return `${timestamp} ${id}: ${messageStyle ? messageStyle(message) : message}`;\r\n  }\r\n\r\n  private getCurrentTime(): string {\r\n    const now = new Date();\r\n    const hours = now.getHours().toString().padStart(2, '0');\r\n    const minutes = now.getMinutes().toString().padStart(2, '0');\r\n    const seconds = now.getSeconds().toString().padStart(2, '0');\r\n    const millis = now.getMilliseconds().toString().padStart(3, '0');\r\n    return `${hours}:${minutes}:${seconds}.${millis}`;\r\n  }\r\n\r\n  log(message: string): void {\r\n    // Make message more prominent with bright text and underline\r\n    console.info(this.logFormat('INFO', message, clc.bold.blue, clc.cyan));\r\n  }\r\n\r\n  error(message: string|Error, trace?: string): void {\r\n    console.error(this.logFormat('ERROR', (message as Error)?.message ?? message, clc.bold.redBright, clc.red));\r\n    if (trace ?? (message as Error)?.stack) {\r\n      console.error(clc.red(trace ?? (message as Error)?.stack));\r\n    }\r\n  }\r\n\r\n  warn(message: string): void {\r\n    console.warn(this.logFormat('WARN', message, clc.bold.yellow, clc.yellow));\r\n  }\r\n\r\n  debug(message: string): void {\r\n    console.debug(this.logFormat('DEBUG', message, clc.xterm(2), clc.xterm(7)));\r\n  }\r\n\r\n  verbose(message: string): void {\r\n    console.log(this.logFormat('VERBOSE', message, clc.bold.magenta, clc.xterm(7)));\r\n  }\r\n}\r\n\r\nexport {CustomLogger};\r\n","export enum TelegramCommands {\r\n  image = \"image\",\r\n  set_threshold = \"set_threshold\",\r\n  increase_threshold = \"increase_threshold\",\r\n  decrease_threshold = \"decrease_threshold\",\r\n}\r\n\r\nexport const TelegramConfig = 'TelegramConfig';","import {Inject, Injectable, Logger} from '@nestjs/common';\r\nimport {Telegraf} from \"telegraf\";\r\nimport {TelegramCommands, TelegramConfig} from \"@/telegram/telegram-model\";\r\nimport type {TgCommandsExecutor} from \"@/app/app-model\";\r\nimport {CommandContextExtn} from \"telegraf/typings/telegram-types\";\r\nimport {Telegram} from \"node-ts-config\";\r\n\r\n@Injectable()\r\nexport class TelegramService {\r\n  private lastNotificationTime = Date.now();\r\n\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    private readonly bot: Telegraf,\r\n    @Inject(TelegramConfig)\r\n    private readonly tgConfig: Telegram,\r\n  ) {\r\n  }\r\n\r\n  async setup(commandListener: TgCommandsExecutor): Promise<void> {\r\n    this.logger.log(\"Starting telegram service\");\r\n    await this.bot.telegram.setMyCommands([\r\n      {command: TelegramCommands.image, description: \"Get the last image\"},\r\n      {command: TelegramCommands.set_threshold, description: \"Sets new amount of pixels to be changes to fire a notification\"},\r\n      {command: TelegramCommands.increase_threshold, description: \"Double the amount of pixels related to current value to spot a diff\"},\r\n      {command: TelegramCommands.decrease_threshold, description: \"Reduces the amount of pixels related to current value to spot a diff\"},\r\n    ]);\r\n    this.bot.command(TelegramCommands.image, () => commandListener.onAskImage());\r\n    this.bot.command(TelegramCommands.set_threshold, (a: CommandContextExtn) => commandListener.onSetThreshold(a));\r\n    this.bot.command(TelegramCommands.increase_threshold, () => commandListener.onIncreaseThreshold());\r\n    this.bot.command(TelegramCommands.decrease_threshold, () => commandListener.onDecreaseThreshold());\r\n    await this.bot.launch();\r\n  }\r\n\r\n  async sendText(text: string): Promise<void> {\r\n    await this.bot.telegram.sendMessage(this.tgConfig.chatId, text);\r\n  }\r\n\r\n  async sendImage(data: Buffer): Promise<void> {\r\n    const newNotificationTime = Date.now();\r\n    const diffDate = newNotificationTime - this.lastNotificationTime;\r\n    if (diffDate > this.tgConfig.spamDelay) {\r\n      await this.bot.telegram.sendPhoto(this.tgConfig.chatId, {source: data}, {caption: this.tgConfig.message});\r\n      this.lastNotificationTime = newNotificationTime;\r\n      this.logger.log(\"Notification sent\");\r\n    } else {\r\n      this.logger.log(`Skipping sending notification as the last one was sent ${diffDate}ms ago`);\r\n    }\r\n  }\r\n}\r\n","/// <reference path=\"../config/Config.d.ts\" />\r\nimport {Logger, Module} from '@nestjs/common';\r\nimport {TelegramService} from \"@/telegram/telegram-service\";\r\nimport {Telegraf} from \"telegraf\";\r\nimport {config} from 'node-ts-config'\r\nimport {TelegramConfig} from \"@/telegram/telegram-model\";\r\n\r\n@Module({\r\n  exports: [TelegramService],\r\n  providers: [\r\n    Logger,\r\n    TelegramService,\r\n    {\r\n      provide: Telegraf,\r\n      useFactory: () => {\r\n        return new Telegraf(config.telegram.token);\r\n      },\r\n    },\r\n    {\r\n      provide: TelegramConfig,\r\n      useValue: config.telegram,\r\n    }\r\n  ],\r\n})\r\nexport class TelegramModule {\r\n\r\n}\r\n","interface FrameData {\r\n  buffer: Buffer;\r\n  width: number;\r\n  height: number;\r\n  dataSize: number;\r\n}\r\n\r\ninterface INativeModule {\r\n  /**\r\n   * Starts video capture with callback\r\n   * @param deviceName - Name of the video device to capture from\r\n   * @param frameRate - Desired frame rate for capture\r\n   * @param callback - Function called when new frames are available\r\n   */\r\n  start(deviceName: string, frameRate: number, callback: (frameInfo: any) => void): void;\r\n\r\n  /**\r\n   * Stops video capture\r\n   */\r\n  stop(): void;\r\n\r\n  /**\r\n   * Gets the latest captured frame\r\n   * @returns FrameData object with RGB buffer and dimensions, or null if no frame available\r\n   */\r\n  getFrame(): FrameData | null;\r\n\r\n  // High-Performance RGB Functions\r\n  /**\r\n   * Convert RGB image buffer to JPEG buffer asynchronously\r\n   * @param rgbBuffer - Buffer containing RGB image data\r\n   * @param width - Image width in pixels\r\n   * @param height - Image height in pixels\r\n   * @returns Promise<Buffer> containing JPEG data\r\n   * @throws Error if conversion fails\r\n   */\r\n  convertRgbToJpeg(rgbBuffer: Buffer, width: number, height: number): Promise<Buffer>;\r\n\r\n  /**\r\n   * Compare two RGB images and count different pixels asynchronously\r\n   * @param rgbBuffer1 - Buffer containing first RGB image data\r\n   * @param rgbBuffer2 - Buffer containing second RGB image data\r\n   * @param width - Image width in pixels\r\n   * @param height - Image height in pixels\r\n   * @param threshold - Threshold for pixel difference (0-1, similar to pixelmatch)\r\n   * @returns Promise<number> containing the number of different pixels\r\n   * @throws Error if comparison fails\r\n   */\r\n  compareRgbImages(rgbBuffer1: Buffer, rgbBuffer2: Buffer, width: number, height: number, threshold: number): Promise<number>;\r\n\r\n  // loaded by nodejs\r\n  path: string;\r\n}\r\n\r\nexport const Native = 'Native';\r\n\r\nexport type {\r\n  INativeModule,\r\n  FrameData,\r\n};\r\n\r\n","export const imageLibConf = 'ImageLibConf'","import {Inject, Injectable, Logger} from '@nestjs/common';\r\nimport {FrameData, INativeModule, Native} from '@/native/native-model';\r\nimport {Diff} from \"node-ts-config\";\r\nimport {imageLibConf} from \"@/imagelib/imagelib-model\";\r\n\r\n\r\n@Injectable()\r\nexport class ImagelibService {\r\n  private oldFrame: FrameData | null = null;\r\n\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    @Inject(Native)\r\n    private readonly native: INativeModule,\r\n    @Inject(imageLibConf)\r\n    public readonly conf: Diff,\r\n  ) {\r\n  }\r\n\r\n  async getLastImage(): Promise<Buffer | null> {\r\n    if (!this.oldFrame) {\r\n      return null;\r\n    }\r\n\r\n    return await this.native.convertRgbToJpeg(this.oldFrame.buffer, this.oldFrame.width, this.oldFrame.height);\r\n  }\r\n\r\n  async getImageIfItsChanged(frameData: FrameData): Promise<Buffer | null> {\r\n    if (!frameData || !frameData.buffer || frameData.buffer.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    if (!this.oldFrame) {\r\n      this.oldFrame = frameData;\r\n      return null;\r\n    }\r\n\r\n    const diffPixels = await this.native.compareRgbImages(\r\n      this.oldFrame.buffer, \r\n      frameData.buffer, \r\n      frameData.width, \r\n      frameData.height, \r\n      this.conf.threshold\r\n    );\r\n    \r\n    if (diffPixels < this.conf.pixels) {\r\n      return null;\r\n    }\r\n    \r\n    this.logger.log(`‚ö†Ô∏è CHANGE DETECTED: ${diffPixels} pixels`);\r\n\r\n    const jpegBuffer = await this.native.convertRgbToJpeg(frameData.buffer, frameData.width, frameData.height);\r\n\r\n    this.oldFrame = frameData;\r\n    return jpegBuffer;\r\n  }\r\n}\r\n","import {Inject, Logger, Module} from '@nestjs/common';\r\nimport bindings from 'bindings';\r\nimport {INativeModule, Native} from \"@/native/native-model\";\r\nimport clc from \"cli-color\";\r\n\r\n\r\n@Module({\r\n  providers: [\r\n    Logger,\r\n    {\r\n      provide: Native,\r\n      useFactory: (): INativeModule => {\r\n        // Check if we're running in a SEA context by looking for sea-assets folder\r\n        return bindings('native');\r\n      },\r\n    },\r\n  ],\r\n  exports: [Native],\r\n})\r\nexport class NativeModule {\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    @Inject(Native)\r\n    private readonly native: INativeModule\r\n  ) {\r\n  }\r\n\r\n  onModuleInit(): any {\r\n    this.logger.log(`Loaded native library from ${clc.bold.green(this.native.path)}`);\r\n  }\r\n}\r\n","/// <reference path=\"../config/Config.d.ts\" />\r\nimport {Logger, Module} from '@nestjs/common';\r\nimport {config} from 'node-ts-config'\r\nimport {ImagelibService} from \"@/imagelib/imagelib-service\";\r\nimport {NativeModule} from \"@/native/native-module\";\r\nimport {imageLibConf} from \"@/imagelib/imagelib-model\";\r\n\r\n@Module({\r\n  imports: [NativeModule],\r\n  providers: [\r\n    Logger,\r\n    {\r\n      provide: imageLibConf,\r\n      useValue: config.diff,\r\n    },\r\n    ImagelibService,\r\n  ],\r\n  exports: [ImagelibService]\r\n})\r\nexport class ImagelibModule {\r\n\r\n}\r\n","export const CameraConf = 'CameraConf';","import {Inject, Injectable, Logger} from '@nestjs/common';\r\nimport type {FrameDetector} from \"@/app/app-model\";\r\nimport {INativeModule, Native} from \"@/native/native-model\";\r\nimport {Camera} from \"node-ts-config\";\r\nimport {CameraConf} from \"@/stream/stream-model\";\r\n\r\n@Injectable()\r\nexport class StreamService {\r\n\r\n  private exitTimeout: NodeJS.Timeout| null = null;\r\n\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    @Inject(Native)\r\n    private readonly captureService: INativeModule,\r\n    @Inject(CameraConf)\r\n    private readonly conf: Camera,\r\n  ) {\r\n  }\r\n\r\n  async listen(frameListener: FrameDetector): Promise<void> {\r\n    // Start capture with the new API - pass the callback directly\r\n    this.exitOnTimeout();\r\n    this.captureService.start(this.conf.name, this.conf.frameRate, async (frameInfo: any) => {\r\n      clearTimeout(this.exitTimeout!);\r\n      this.exitOnTimeout()\r\n      if (frameInfo) {\r\n        process.stdout.write(\".\");\r\n        await frameListener.onNewFrame(frameInfo);\r\n      }\r\n    });\r\n    this.logger.log(`DirectShow capture started for device: ${this.conf.name}`);\r\n  }\r\n\r\n  private exitOnTimeout() {\r\n    this.exitTimeout = setTimeout(() => {\r\n      throw Error(\"Frame capturing didn't produce any data for 5s, exiting...\")\r\n    }, 5000);\r\n  }\r\n}\r\n","/// <reference path=\"../config/Config.d.ts\" />\r\nimport {Logger, Module} from '@nestjs/common';\r\nimport {config} from 'node-ts-config'\r\nimport {StreamService} from \"@/stream/stream-service\";\r\nimport {NativeModule} from \"@/native/native-module\";\r\nimport {CameraConf} from \"@/stream/stream-model\";\r\n\r\n@Module({\r\n  imports: [NativeModule],\r\n  exports: [StreamService],\r\n  providers: [\r\n    Logger,\r\n    {\r\n      provide: CameraConf,\r\n      useValue: config.camera\r\n    },\r\n    StreamService,\r\n  ],\r\n})\r\nexport class StreamModule {\r\n\r\n}\r\n","import {Injectable, Logger} from '@nestjs/common';\r\nimport {TelegramService} from \"@/telegram/telegram-service\";\r\nimport {ImagelibService} from \"@/imagelib/imagelib-service\";\r\nimport {StreamService} from \"@/stream/stream-service\";\r\nimport type {GlobalService} from \"@/app/app-model\";\r\nimport {CommandContextExtn} from \"telegraf/typings/telegram-types\";\r\nimport {TelegramCommands} from \"@/telegram/telegram-model\";\r\nimport {FrameData} from \"@/native/native-model\";\r\n\r\n@Injectable()\r\nexport class AppService implements GlobalService {\r\n\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    private readonly ss: StreamService,\r\n    private readonly telegram: TelegramService,\r\n    private readonly im: ImagelibService,\r\n  ) {\r\n  }\r\n\r\n  async onIncreaseThreshold(): Promise<void> {\r\n    this.im.conf.threshold = Math.ceil(this.im.conf.threshold * 2);\r\n    await this.telegram.sendText(`Increase threshold to ${this.im.conf.threshold}`);\r\n  }\r\n\r\n  async onDecreaseThreshold(): Promise<void> {\r\n    this.im.conf.threshold = Math.ceil(this.im.conf.threshold / 2);\r\n    await this.telegram.sendText(`Decreased threshold to ${this.im.conf.threshold}`);\r\n  }\r\n\r\n  async onAskImage(): Promise<void> {\r\n    this.logger.log(`Got image command`);\r\n    const image = await this.im.getLastImage();\r\n    if (image) {\r\n      await this.telegram.sendImage(image);\r\n    } else {\r\n      await this.telegram.sendText(`No image in cache`);\r\n      this.logger.log(`No current image found, skipping`);\r\n    }\r\n  }\r\n\r\n  async onSetThreshold(a: CommandContextExtn): Promise<void> {\r\n    const newThreshold = Number(a.payload)\r\n    if (newThreshold > 0) {\r\n      this.im.conf.threshold = newThreshold;\r\n    } else {\r\n      await this.telegram.sendText(`${TelegramCommands.set_threshold} required number parameter. ${a.payload} is not a number`);\r\n    }\r\n  }\r\n\r\n  public async onNewFrame(frameData: FrameData) {\r\n    const image = await this.im.getImageIfItsChanged(frameData);\r\n    if (image) {\r\n      await this.telegram.sendImage(image);\r\n    }\r\n  }\r\n\r\n  async run(): Promise<void> {\r\n    await this.ss.listen(this);\r\n    await this.telegram.setup(this);\r\n  }\r\n}\r\n","/// <reference path=\"../config/Config.d.ts\" />\r\nimport {Logger, Module, OnModuleInit} from '@nestjs/common';\r\nimport {TelegramModule} from \"@/telegram/telegram-module\";\r\nimport {ImagelibModule} from \"@/imagelib/imagelib-module\";\r\nimport {StreamModule} from \"@/stream/stream-module\";\r\nimport {AppService} from \"@/app/app-service\";\r\n\r\n@Module({\r\n  imports: [StreamModule, TelegramModule, ImagelibModule],\r\n  providers: [Logger, AppService]\r\n})\r\nexport class AppModule implements OnModuleInit {\r\n\r\n  constructor(\r\n    private readonly as: AppService,\r\n  ) {\r\n  }\r\n\r\n  async onModuleInit() {\r\n    await this.as.run();\r\n  }\r\n}\r\n","import { join } from 'path';\nimport * as process from 'node:process';\nprocess.env['NODE_CONFIG_TS_DIR'] = join(__dirname, 'config');\n\nimport { readFileSync } from 'node:fs';\nimport { NestFactory } from '@nestjs/core';\nimport { CustomLogger } from '@/app/custom-logger';\nimport { AppModule } from \"@/app/app-module\";\nimport * as readline from 'readline';\n\n// Load configuration directly\nconst configPath = join(process.env.NODE_CONFIG_TS_DIR, 'default.json');\nconst config = JSON.parse(readFileSync(configPath, 'utf-8'));\n\n// Bootstrap function that handles configuration\nasync function bootstrap() {\n  console.log('üîß Stream Alert Configuration');\n  console.log('================================\\n');\n\n  // Create readline interface for user input\n  const rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout\n  });\n\n  // Helper function to prompt user for input\n  function prompt(question: string, defaultValue: string | null = null): Promise<string> {\n    return new Promise((resolve) => {\n      const promptText = defaultValue !== null \n        ? `${question} (default: ${defaultValue}): `\n        : `${question}: `;\n      \n      rl.question(promptText, (answer) => {\n        if (answer.trim() === '' && defaultValue !== null) {\n          resolve(defaultValue);\n        } else {\n          resolve(answer.trim());\n        }\n      });\n    });\n  }\n\n  // Helper function to validate and convert input\n  function validateAndConvert(value: string, type: string, fieldName: string): any {\n    switch (type) {\n      case 'number':\n        const num = parseFloat(value);\n        if (isNaN(num)) {\n          throw new Error(`${fieldName} must be a valid number`);\n        }\n        return num;\n      case 'string':\n        if (!value || value.trim() === '') {\n          throw new Error(`${fieldName} cannot be empty`);\n        }\n        return value;\n      default:\n        return value;\n    }\n  }\n\n  // Helper function to check if value is from environment variable marker\n  function isEnvVariable(value: any): boolean {\n    return typeof value === 'string' && value.startsWith('@@');\n  }\n\n  try {\n    // Configure Telegram section\n    console.log('üì± Telegram Configuration');\n    console.log('--------------------------');\n    \n    const telegramToken = isEnvVariable(config.telegram.token) \n      ? await prompt('Telegram bot token')\n      : await prompt('Telegram bot token', config.telegram.token);\n    config.telegram.token = validateAndConvert(telegramToken, 'string', 'Telegram token');\n\n    const telegramChatId = isEnvVariable(config.telegram.chatId)\n      ? await prompt('Telegram chat ID')\n      : await prompt('Telegram chat ID', config.telegram.chatId.toString());\n    config.telegram.chatId = validateAndConvert(telegramChatId, 'number', 'Telegram chat ID');\n\n    const telegramSpamDelay = isEnvVariable(config.telegram.spamDelay)\n      ? await prompt('Spam delay in milliseconds')\n      : await prompt('Spam delay in milliseconds', config.telegram.spamDelay.toString());\n    config.telegram.spamDelay = validateAndConvert(telegramSpamDelay, 'number', 'Spam delay');\n\n    const telegramMessage = isEnvVariable(config.telegram.message)\n      ? await prompt('Default message for alerts')\n      : await prompt('Default message for alerts', config.telegram.message);\n    config.telegram.message = validateAndConvert(telegramMessage, 'string', 'Telegram message');\n\n    console.log('');\n\n    // Configure Camera section\n    console.log('üì∑ Camera Configuration');\n    console.log('------------------------');\n    \n    const cameraName = isEnvVariable(config.camera.name)\n      ? await prompt('Camera name')\n      : await prompt('Camera name', config.camera.name);\n    config.camera.name = validateAndConvert(cameraName, 'string', 'Camera name');\n\n    const cameraFrameRate = isEnvVariable(config.camera.frameRate)\n      ? await prompt('Frame rate (frames per second)')\n      : await prompt('Frame rate (frames per second)', config.camera.frameRate.toString());\n    config.camera.frameRate = validateAndConvert(cameraFrameRate, 'number', 'Frame rate');\n\n    console.log('');\n\n    // Configure Diff section\n    console.log('üîç Motion Detection Configuration');\n    console.log('----------------------------------');\n    \n    const diffPixels = isEnvVariable(config.diff.pixels)\n      ? await prompt('Minimum pixels changed to trigger detection')\n      : await prompt('Minimum pixels changed to trigger detection', config.diff.pixels.toString());\n    config.diff.pixels = validateAndConvert(diffPixels, 'number', 'Diff pixels');\n\n    const diffThreshold = isEnvVariable(config.diff.threshold)\n      ? await prompt('Threshold for pixel changes (0.0 - 1.0)')\n      : await prompt('Threshold for pixel changes (0.0 - 1.0)', config.diff.threshold.toString());\n    const threshold = validateAndConvert(diffThreshold, 'number', 'Diff threshold');\n    if (threshold < 0 || threshold > 1) {\n      throw new Error('Diff threshold must be between 0.0 and 1.0');\n    }\n    config.diff.threshold = threshold;\n\n    console.log('\\n‚úÖ Configuration completed successfully!');\n    console.log('Starting application...\\n');\n    \n    rl.close();\n\n    // Write updated config back to file\n    const updatedConfig = JSON.stringify(config, null, 2);\n    require('fs').writeFileSync(configPath, updatedConfig);\n\n    // Start the NestJS application\n    const customLogger = new CustomLogger();\n    const app = await NestFactory.createApplicationContext(AppModule, {\n      logger: customLogger,\n    });\n\n    console.log('Application started successfully');\n\n  } catch (error) {\n    console.error('‚ùå Configuration error:', error.message);\n    rl.close();\n    process.exit(1);\n  }\n}\n\nbootstrap();\n"],"names":["ConsoleLogger","__decorateClass","Injectable","TelegramCommands","__decorateParam","Module","Logger","Telegraf","config","process","join","readFileSync","readline","NestFactory"],"mappings":"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"}